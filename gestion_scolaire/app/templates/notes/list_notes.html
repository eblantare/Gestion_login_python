{% extends "ebase.html" %}

{% block title %}Liste des Notes{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-3">üìö Liste des Notes</h2>

    <!-- üîç Barre de recherche + filtres + bouton Ajouter -->
    <form method="get" class="d-flex align-items-center mb-3 gap-2 flex-wrap">
        <!-- üîç Barre de recherche compacte -->
        <div style="flex: 0.3 0 140px; min-width: 130px;">
            <div class="input-group rounded-pill border overflow-hidden">
                <input type="text" name="search" value="{{ search }}" class="form-control border-0" 
                       placeholder="Rechercher..." style="width: 100px;">
                <button type="submit" class="btn btn-primary btn-sm">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </div>

        <!-- Filtre √©l√®ve -->
        <div style="flex: 0.3 0 140px; min-width: 130px;">
            <select name="eleve_id" class="form-select form-select-sm rounded-pill" style="width: 100%;" onchange="this.form.submit()">
                <option value="">√âl√®ve</option>
                {% for e in eleves %}
                <option value="{{ e.id|string }}" {% if eleve_id == e.id|string %}selected{% endif %}>
                    {{ e.nom }} {{ e.prenoms }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Filtre mati√®re -->
        <div style="flex: 0.3 0 140px; min-width: 130px;">
            <select name="matiere_id" class="form-select form-select-sm rounded-pill" style="width: 100%;" onchange="this.form.submit()">
                <option value="">Mati√®re</option>
                {% for m in matieres %}
                <option value="{{ m.id|string }}" {% if matiere_id == m.id|string %}selected{% endif %}>
                    {{ m.libelle }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Filtre classe -->
        <div style="flex: 0.3 0 140px; min-width: 130px;">
            <select id="classeFilterList" name="classe_id" class="form-select form-select-sm rounded-pill" style="width: 100%;" onchange="this.form.submit()">
                <option value="">Classe</option>
                {% for c in classes %}
                <option value="{{ c.id|string }}" {% if classe_id == c.id|string %}selected{% endif %}>
                    {{ c.nom }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Nombre par page -->
        <div style="flex: 0.2 0 100px; min-width: 90px;">
            <select name="per_page" class="form-select form-select-sm rounded-pill" style="width: 100%;" onchange="this.form.submit()">
                {% for n in [5,10,20,50,100,250,500,1000] %}
                <option value="{{ n }}" {% if per_page == n %}selected{% endif %}>{{ n }}/page</option>
                {% endfor %}
            </select>
        </div>

        <!-- Bouton Ajouter -->
        <div>
            <button type="button" class="btn btn-success btn-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#addNoteModal">
                <i class="bi bi-plus-circle"></i>
            </button>
        </div>
        
        <!-- SUPPRIMER LE BOUTON EXPORTER ICI -->
    </form>

    <!-- üìä Tableau des notes -->
    <div class="table-responsive">
        <table id="notesTable" class="table table-bordered table-hover text-center align-middle" style="min-width: 1000px;">
            <thead class="table-dark">
                <tr>
                    <th scope="col">√âl√®ve</th>
                    <th scope="col">Mati√®re</th>
                    <th scope="col">Note 1</th>
                    <th scope="col">Note 2</th>
                    <th scope="col">Note 3</th>
                    <th scope="col">Comp.</th>
                    <th scope="col">Coef.</th>
                    <th scope="col">Enseignant</th>
                    <th scope="col">Trimestre</th>
                    <th scope="col">Ann√©e</th>
                    <th scope="col">Date</th>
                    <th scope="col" class="actions">Actions</th>
                    <th scope="col" class="etat">√âtat</th>
                </tr>
            </thead>
            <tbody>
                {% for note in notes %}
                    {% include "notes/_note_row.html" %}
                {% else %}
                    <tr>
                        <td colspan="13" class="text-center">Aucune note trouv√©e</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- üìå Pagination -->
    <nav>
        <ul class="pagination justify-content-center">
            {% if pagination.has_prev %}
            <li class="page-item">
                <a class="page-link" href="?page={{ pagination.prev_num }}&per_page={{ per_page }}&search={{ search }}">Pr√©c√©dent</a>
            </li>
            {% endif %}

            {% for p in pagination.iter_pages() %}
                {% if p %}
                    <li class="page-item {% if p == pagination.page %}active{% endif %}">
                        <a class="page-link" href="?page={{ p }}&per_page={{ per_page }}&search={{ search }}">{{ p }}</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">‚Ä¶</span></li>
                {% endif %}
            {% endfor %}

            {% if pagination.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ pagination.next_num }}&per_page={{ per_page }}&search={{ search }}">Suivant</a>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>

{% include 'notes/add_notes.html' %}
{% include 'notes/delete_notes.html' %}
{% include 'notes/detail_notes.html' %}
{% include 'notes/update_notes.html' %}

<!-- Modal confirmation des actions -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content border-0">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Confirmer la suppression</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <p class="fw-bold" id="deleteConfirmMessage">Voulez-vous vraiment supprimer cette note ?</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Non</button>
                <button type="button" class="btn btn-danger rounded-pill" id="deleteConfirmYesBtn">Oui</button>
            </div>
        </div>
    </div>
</div>

<!-- SUPPRIMER LE MODAL D'EXPORTATION DES NOTES ICI -->
{% endblock %}